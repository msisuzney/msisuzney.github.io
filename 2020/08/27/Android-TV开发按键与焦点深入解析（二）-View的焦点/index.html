<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.4.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/avatar.jpg">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/avatar.jpg">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/avatar.jpg">
  <link rel="mask-icon" href="/images/avatar.jpg" color="#222">
  <link rel="manifest" href="/images/avatar.jpg">

<link rel="stylesheet" href="/css/main.css">

<link rel="stylesheet" href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic|Playball:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext">
<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"msisuzney.github.io","root":"/","scheme":"Muse","version":"7.8.0","exturl":false,"sidebar":{"position":"right","display":"hide","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta name="description" content="ä¸Šä¸€ç¯‡åˆ†æåˆ°äº†KeyEventçš„åˆ†å‘å…¶å®å°±æ˜¯æŠŠäº‹ä»¶äº¤ç»™äº†ç„¦ç‚¹Viewå¤„ç†ï¼Œé‚£æ€ä¹ˆå»å®šä¹‰ä¸€ä¸ªViewå¯è·å¾—ç„¦ç‚¹ï¼Ÿå…¶å®å¾ˆç®€å•ï¼Œåªéœ€è¦åœ¨xmlå¸ƒå±€ä¸­è®¾ç½®Viewçš„focusableå±æ€§ä¸ºtrueå°±å¯ä»¥äº†ï¼Œé‚£ç°åœ¨å°±å¼€å§‹åˆ†æè¿™ä¸ªfocusableå±æ€§ç©¶ç«Ÿæ˜¯æ€ä¹ˆå‘æŒ¥å®ƒçš„ä½œç”¨çš„ã€‚">
<meta property="og:type" content="article">
<meta property="og:title" content="Android TVå¼€å‘æŒ‰é”®ä¸ç„¦ç‚¹æ·±å…¥åˆ†æï¼ˆäºŒï¼‰--Viewçš„ç„¦ç‚¹">
<meta property="og:url" content="https://msisuzney.github.io/2020/08/27/Android-TV%E5%BC%80%E5%8F%91%E6%8C%89%E9%94%AE%E4%B8%8E%E7%84%A6%E7%82%B9%E6%B7%B1%E5%85%A5%E8%A7%A3%E6%9E%90%EF%BC%88%E4%BA%8C%EF%BC%89-View%E7%9A%84%E7%84%A6%E7%82%B9/index.html">
<meta property="og:site_name" content="chenxin&#39;s blog">
<meta property="og:description" content="ä¸Šä¸€ç¯‡åˆ†æåˆ°äº†KeyEventçš„åˆ†å‘å…¶å®å°±æ˜¯æŠŠäº‹ä»¶äº¤ç»™äº†ç„¦ç‚¹Viewå¤„ç†ï¼Œé‚£æ€ä¹ˆå»å®šä¹‰ä¸€ä¸ªViewå¯è·å¾—ç„¦ç‚¹ï¼Ÿå…¶å®å¾ˆç®€å•ï¼Œåªéœ€è¦åœ¨xmlå¸ƒå±€ä¸­è®¾ç½®Viewçš„focusableå±æ€§ä¸ºtrueå°±å¯ä»¥äº†ï¼Œé‚£ç°åœ¨å°±å¼€å§‹åˆ†æè¿™ä¸ªfocusableå±æ€§ç©¶ç«Ÿæ˜¯æ€ä¹ˆå‘æŒ¥å®ƒçš„ä½œç”¨çš„ã€‚">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://raw.githubusercontent.com/msisuzney/MyBlog/master/images/6_focusable.png">
<meta property="og:image" content="https://raw.githubusercontent.com/msisuzney/MyBlog/master/images/6_requestFocus.png">
<meta property="article:published_time" content="2020-08-27T14:19:04.000Z">
<meta property="article:modified_time" content="2021-11-21T06:14:32.890Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://raw.githubusercontent.com/msisuzney/MyBlog/master/images/6_focusable.png">

<link rel="canonical" href="https://msisuzney.github.io/2020/08/27/Android-TV%E5%BC%80%E5%8F%91%E6%8C%89%E9%94%AE%E4%B8%8E%E7%84%A6%E7%82%B9%E6%B7%B1%E5%85%A5%E8%A7%A3%E6%9E%90%EF%BC%88%E4%BA%8C%EF%BC%89-View%E7%9A%84%E7%84%A6%E7%82%B9/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script>

  <title>Android TVå¼€å‘æŒ‰é”®ä¸ç„¦ç‚¹æ·±å…¥åˆ†æï¼ˆäºŒï¼‰--Viewçš„ç„¦ç‚¹ | chenxin's blog</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="åˆ‡æ¢å¯¼èˆªæ ">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">chenxin's blog</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>é¦–é¡µ</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>åˆ†ç±»<span class="badge">8</span></a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>å½’æ¡£<span class="badge">24</span></a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://msisuzney.github.io/2020/08/27/Android-TV%E5%BC%80%E5%8F%91%E6%8C%89%E9%94%AE%E4%B8%8E%E7%84%A6%E7%82%B9%E6%B7%B1%E5%85%A5%E8%A7%A3%E6%9E%90%EF%BC%88%E4%BA%8C%EF%BC%89-View%E7%9A%84%E7%84%A6%E7%82%B9/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="æ—¶å…‰çš„çƒ‚ç¬”å¤´">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="chenxin's blog">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          Android TVå¼€å‘æŒ‰é”®ä¸ç„¦ç‚¹æ·±å…¥åˆ†æï¼ˆäºŒï¼‰--Viewçš„ç„¦ç‚¹
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">å‘è¡¨äº</span>

              <time title="åˆ›å»ºæ—¶é—´ï¼š2020-08-27 22:19:04" itemprop="dateCreated datePublished" datetime="2020-08-27T22:19:04+08:00">2020-08-27</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">æ›´æ–°äº</span>
                <time title="ä¿®æ”¹æ—¶é—´ï¼š2021-11-21 14:14:32" itemprop="dateModified" datetime="2021-11-21T14:14:32+08:00">2021-11-21</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">åˆ†ç±»äº</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/android-TV/" itemprop="url" rel="index"><span itemprop="name">android TV</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <p>ä¸Šä¸€ç¯‡åˆ†æåˆ°äº†KeyEventçš„åˆ†å‘å…¶å®å°±æ˜¯æŠŠäº‹ä»¶äº¤ç»™äº†ç„¦ç‚¹Viewå¤„ç†ï¼Œé‚£æ€ä¹ˆå»å®šä¹‰ä¸€ä¸ªViewå¯è·å¾—ç„¦ç‚¹ï¼Ÿå…¶å®å¾ˆç®€å•ï¼Œåªéœ€è¦åœ¨xmlå¸ƒå±€ä¸­è®¾ç½®Viewçš„focusableå±æ€§ä¸ºtrueå°±å¯ä»¥äº†ï¼Œé‚£ç°åœ¨å°±å¼€å§‹åˆ†æè¿™ä¸ªfocusableå±æ€§ç©¶ç«Ÿæ˜¯æ€ä¹ˆå‘æŒ¥å®ƒçš„ä½œç”¨çš„ã€‚</p>
<span id="more"></span>
<h3 id="Viewçš„ç„¦ç‚¹æ¨¡å¼"><a href="#Viewçš„ç„¦ç‚¹æ¨¡å¼" class="headerlink" title="Viewçš„ç„¦ç‚¹æ¨¡å¼"></a>Viewçš„ç„¦ç‚¹æ¨¡å¼</h3><p>Viewå®šä¹‰äº†ä¸‰ç§ç„¦ç‚¹æ¨¡å¼ï¼Œç›´æ¥çœ‹å®ƒä»¬åœ¨ä»£ç ä¸­å®šä¹‰ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">    * This view does not want keystrokes.</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> NOT_FOCUSABLE = <span class="number">0x00000000</span>;</span><br><span class="line"></span><br><span class="line">   <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * This view wants keystrokes.</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> FOCUSABLE = <span class="number">0x00000001</span>;</span><br><span class="line"></span><br><span class="line">   <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * This view determines focusability automatically. This is the default.</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> FOCUSABLE_AUTO = <span class="number">0x00000010</span>;</span><br><span class="line"></span><br><span class="line">   <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * Mask for use with setFlags indicating bits used for focus.</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> FOCUSABLE_MASK = <span class="number">0x00000011</span>;</span><br><span class="line"></span><br><span class="line">   <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * The view flags hold various views states.</span></span><br><span class="line"><span class="comment">    * &#123;<span class="doctag">@hide</span>&#125;</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   <span class="meta">@ViewDebug</span>.ExportedProperty(formatToHexString = <span class="keyword">true</span>)</span><br><span class="line">   <span class="keyword">int</span> mViewFlags;</span><br></pre></td></tr></table></figure>
<p>å…¶ä¸­FOCUSABLE_MASKè¡¨ç¤ºfoucsableå±æ€§å ç”¨mViewFlagsçš„bitä½ç½®ï¼Œå¯ä»¥çœ‹å‡ºmViewFlagsä¸­ç¬¬1ä½å’Œç¬¬5ä½ç”¨æ¥è”åˆè¡¨ç¤ºviewçš„ç„¦ç‚¹æ¨¡å¼ï¼Œæœ‰FOCUSABLEã€NOT_FOCUSABLEå’ŒFOCUSABLE_AUTOä¸‰ç§ç„¦ç‚¹æ¨¡å¼ï¼Œç¬¬1ä½æ§åˆ¶FOCUSABLEã€NOT_FOCUSABLEï¼Œç¬¬5ä½å•ç‹¬æ§åˆ¶FOCUSABLE_AUTO.<br>æ¥ç€çœ‹çœ‹Viewçš„æ„é€ æ–¹æ³•ä¸­è§£æxmlå¸ƒå±€è®¾ç½®çš„focusableå±æ€§çš„è¿‡ç¨‹ï¼Œä¸»è¦çš„ä»£ç å¦‚ä¸‹ï¼š<br> <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">Viewçš„æ„é€ æ–¹æ³•ä¸­    </span><br><span class="line"> <span class="function"><span class="keyword">public</span> <span class="title">View</span><span class="params">(Context context, <span class="meta">@Nullable</span> AttributeSet attrs,</span></span></span><br><span class="line"><span class="params"><span class="function">             <span class="keyword">int</span> defStyleAttr, <span class="keyword">int</span> defStyleRes)</span> </span>&#123;</span><br><span class="line">      <span class="comment">//è®¾ç½®é»˜è®¤çš„å€¼</span></span><br><span class="line">       mViewFlags =  FOCUSABLE_AUTO;</span><br><span class="line">        <span class="comment">// Set default values.</span></span><br><span class="line">        viewFlagValues |= FOCUSABLE_AUTO;</span><br><span class="line">        viewFlagMasks |= FOCUSABLE_AUTO;</span><br><span class="line">		......</span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; N; i++) &#123;</span><br><span class="line">        <span class="comment">//è·å–xmlæ–‡ä»¶ä¸­è®¾ç½®çš„çš„ç„¦ç‚¹çŠ¶æ€</span></span><br><span class="line">        <span class="keyword">case</span> com.android.internal.R.styleable.View_focusable:</span><br><span class="line">        <span class="comment">// (viewFlagValues &amp; ~FOCUSABLE_MASK)  å°†ç„¦ç‚¹çŠ¶æ€ç½®ä¸ºç©ºï¼Œâ€œä¸|â€å°†ä»xmlä¸­è·å–çš„ç„¦ç‚¹çŠ¶æ€èµ‹å€¼ç»™viewFlagValues</span></span><br><span class="line">        viewFlagValues = (viewFlagValues &amp; ~FOCUSABLE_MASK) | getFocusableAttribute(a);</span><br><span class="line">        <span class="comment">//å¦‚æœviewFlagValuesä¸­çš„ç„¦ç‚¹çŠ¶æ€ä¸å†æ˜¯FOCUSABLE_AUTOï¼Œè¯´æ˜ç„¦ç‚¹çŠ¶æ€å˜äº†ï¼Œä¿®æ”¹ä½å˜åŒ–è®°å½•maskå€¼</span></span><br><span class="line">        <span class="keyword">if</span> ((viewFlagValues &amp; FOCUSABLE_AUTO) == <span class="number">0</span>) &#123;</span><br><span class="line">            viewFlagMasks |= FOCUSABLE_MASK;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">     &#125;</span><br><span class="line">    	.......</span><br><span class="line">     <span class="keyword">if</span> (viewFlagMasks != <span class="number">0</span>) &#123;</span><br><span class="line">         setFlags(viewFlagValues, viewFlagMasks);</span><br><span class="line">     &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//å°†xmlä¸­è®¾ç½®çš„ç„¦ç‚¹çŠ¶æ€è½¬æ¢ä¸ºViewè‡ªå·±å®šä¹‰çš„äºŒè¿›åˆ¶æ ¼å¼</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">int</span> <span class="title">getFocusableAttribute</span><span class="params">(TypedArray attributes)</span> </span>&#123;</span><br><span class="line">    TypedValue val = <span class="keyword">new</span> TypedValue();</span><br><span class="line">    <span class="keyword">if</span> (attributes.getValue(com.android.internal.R.styleable.View_focusable, val)) &#123;</span><br><span class="line">        <span class="keyword">if</span> (val.type == TypedValue.TYPE_INT_BOOLEAN) &#123;</span><br><span class="line">            <span class="keyword">return</span> (val.data == <span class="number">0</span> ? NOT_FOCUSABLE : FOCUSABLE);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> val.data;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> FOCUSABLE_AUTO;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br>åœ¨æœ€å¼€å§‹çš„æ—¶å€™è®¾ç½®äº†Viewçš„ç„¦ç‚¹æ¨¡å¼ä¸ºFOCUSABLE_AUTOï¼Œåœ¨éå†å±æ€§æ—¶å¦‚æœxmlå¸ƒå±€æœ‰è®¾ç½®focusableå±æ€§ï¼Œåˆ™å–å‡ºï¼Œæ²¡æœ‰çš„è¯ä¾ç„¶æ˜¯FOCUSABLE_AUTO,è¿™æ ·focuableå±æ€§å°±è½¬æ¢æˆäº†viewFlagValuesä¸­çš„å‚æ•°ï¼Œæ„é€ æ–¹æ³•æœ€åè¿˜è°ƒç”¨äº†setFlagsæ–¹æ³•è®¾ç½®mViewFlagsï¼Œè¿™ä¸ªæ–¹æ³•å†…è¿˜å¤„ç†è®¾ç½®äº†clickableä½†æ²¡æœ‰è®¾ç½®focusableçš„æƒ…å†µï¼Œå¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">Viewä¸­</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">setFlags</span><span class="params">(<span class="keyword">int</span> flags, <span class="keyword">int</span> mask)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//å°†flagså˜åŒ–äº†çš„bitåŒæ­¥åˆ°å…¨å±€å˜é‡mViewFlagsä¸­</span></span><br><span class="line">        mViewFlags = (mViewFlags &amp; ~mask) | (flags &amp; mask);</span><br><span class="line">		......</span><br><span class="line">        <span class="comment">// If focusable is auto, update the FOCUSABLE bit.</span></span><br><span class="line">        <span class="keyword">int</span> focusableChangedByAuto = <span class="number">0</span>;</span><br><span class="line">        <span class="comment">//ç„¦ç‚¹çŠ¶æ€æ˜¯FOCUSABLE_AUTO</span></span><br><span class="line">        <span class="keyword">if</span> (((mViewFlags &amp; FOCUSABLE_AUTO) != <span class="number">0</span>)</span><br><span class="line">                &amp;&amp; (changed &amp; (FOCUSABLE_MASK | CLICKABLE)) != <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="comment">// Heuristic only takes into account whether view is clickable.</span></span><br><span class="line">            <span class="keyword">final</span> <span class="keyword">int</span> newFocus;</span><br><span class="line">            <span class="comment">//Viewå¯ä»¥è¢«ç‚¹å‡»ï¼Œå°†ç„¦ç‚¹çŠ¶æ€æ·»åŠ FOCUSABLEï¼Œå¦åˆ™æ·»åŠ NOT_FOCUSABLE</span></span><br><span class="line">            <span class="keyword">if</span> ((mViewFlags &amp; CLICKABLE) != <span class="number">0</span>) &#123;</span><br><span class="line">                newFocus = FOCUSABLE;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                newFocus = NOT_FOCUSABLE;</span><br><span class="line">            &#125;</span><br><span class="line">            mViewFlags = (mViewFlags &amp; ~FOCUSABLE) | newFocus;</span><br><span class="line">			.....</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>å¯ä»¥çœ‹å‡ºï¼Œå¦‚æœæ˜¯FOCUSABLE_AUTOæƒ…å†µï¼Œä¹Ÿå°±æ˜¯xmlæ–‡ä»¶æ²¡è®¾ç½®focusableå±æ€§ï¼Œç„¦ç‚¹çš„æ¨¡å¼è¿˜ä¸clickableå±æ€§æœ‰å…³ï¼Œå¦‚æœViewæ˜¯clickableçš„ï¼Œé‚£ä¹ˆViewæ˜¯FOCUSABLEï¼Œå¦åˆ™æ˜¯NOT_FOCUSABLEï¼Œå¯ä»¥ç”¨ä¸‹é¢è¿™å¼ è¡¨æ¥æè¿°clickableå’Œfocusableå±æ€§å¯¹Viewçš„ç„¦ç‚¹æ¨¡å¼çš„å½±å“<br><img src="https://raw.githubusercontent.com/msisuzney/MyBlog/master/images/6_focusable.png" alt="focusable.png"></p>
<p>ç°åœ¨å¯ä»¥å›ç­”ä¸Šä¸€ç¯‡ç»“æŸæ—¶æçš„é—®é¢˜äº†ï¼ŒAndroidæ‰‹æœºåº”ç”¨è¿è¡Œåœ¨Androidç”µè§†ä¸Šå¯ä»¥å“åº”æŒ‰é”®äº‹ä»¶å—ï¼Ÿå¦‚æœè¿™ä¸ªViewåœ¨xmlæ–‡ä»¶ä¸­è®¾ç½®äº†clickableå±æ€§ä¸ºtrueé‚£è¿™ä¸ªViewå°±å¯ä»¥è·å¾—ç„¦ç‚¹ï¼Œä¹Ÿå°±å¯ä»¥å“åº”æŒ‰é”®äº‹ä»¶ï¼Œå¦‚æœæ—¢æ²¡æœ‰è®¾ç½®clickableä¹Ÿæ²¡æœ‰è®¾ç½®focusableä¸ºtrueï¼Œé‚£è¿™ä¸ªViewå°±è·å–ä¸åˆ°ç„¦ç‚¹ï¼Œä¹Ÿå°±å“åº”ä¸äº†æŒ‰é”®äº‹ä»¶äº†ã€‚</p>
<p>ä¸‹é¢æ˜¯Viewæä¾›çš„ä¸¤ç§è·å¾—ç„¦ç‚¹æ¨¡å¼çš„æ–¹æ³•</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">Viewä¸­</span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getFocusable</span><span class="params">()</span> </span>&#123;</span><br><span class="line">       <span class="comment">//åªè¦è®¾ç½®äº†FOCUSABLE_AUTOå°±åªè¿”å›FOCUSABLE_AUTO</span></span><br><span class="line">       <span class="keyword">return</span> (mViewFlags &amp; FOCUSABLE_AUTO) &gt; <span class="number">0</span> ? FOCUSABLE_AUTO : mViewFlags &amp; FOCUSABLE;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">boolean</span> <span class="title">isFocusable</span><span class="params">()</span> </span>&#123;</span><br><span class="line">       <span class="keyword">return</span> FOCUSABLE == (mViewFlags &amp; FOCUSABLE);</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>
<p>ä¸€èˆ¬æƒ…å†µæˆ‘ä»¬ä½¿ç”¨isFocusableæ–¹æ³•å°±OKäº†ï¼ŒgetFocusableæ–¹æ³•å¯ä»¥ç”¨æ¥åœ¨å¯ä»¥è·å¾—ç„¦ç‚¹æ—¶åˆ¤æ–­æ˜¯clickableå¯¼è‡´çš„ï¼Œè¿˜æ˜¯focusableè®¾ç½®çš„.</p>
<h3 id="ViewGroupçš„ç„¦ç‚¹æ¨¡å¼"><a href="#ViewGroupçš„ç„¦ç‚¹æ¨¡å¼" class="headerlink" title="ViewGroupçš„ç„¦ç‚¹æ¨¡å¼"></a>ViewGroupçš„ç„¦ç‚¹æ¨¡å¼</h3><p>ä¸Šå°èŠ‚åˆ†æçš„Viewçš„ç„¦ç‚¹æ¨¡å¼å®Œå…¨é€‚ç”¨äºViewGroupï¼Œæ¯•ç«Ÿå®ƒä¹Ÿæ˜¯Viewçš„å„¿å­ï¼Œä½†ç”±äºViewGroupæœ‰å­Viewï¼Œä¸ºäº†é¿å…ç„¦ç‚¹äº§ç”Ÿæ­§ä¹‰ï¼Œè¿˜å®šä¹‰äº†ViewGroupç›¸å¯¹äºå­Viewçš„ä¸‰ç§è·å¾—ç„¦ç‚¹çš„é¡ºåºï¼Œå¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">	åœ¨æ‰€æœ‰å­Viewä¹‹å‰</span></span><br><span class="line"><span class="comment"> * This view will get focus before any of its descendants.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> FOCUS_BEFORE_DESCENDANTS = <span class="number">0x20000</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">	åœ¨æ‰€æœ‰å­Viewä¹‹å</span></span><br><span class="line"><span class="comment"> * This view will get focus only if none of its descendants want it.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> FOCUS_AFTER_DESCENDANTS = <span class="number">0x40000</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">	æ‹¦æˆªæ‰€æœ‰ç„¦ç‚¹ï¼Œä¸é€šçŸ¥å­View</span></span><br><span class="line"><span class="comment"> * This view will block any of its descendants from getting focus, even</span></span><br><span class="line"><span class="comment"> * if they are focusable.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> FOCUS_BLOCK_DESCENDANTS = <span class="number">0x60000</span>;</span><br><span class="line"><span class="comment">//å®šä¹‰mGroupFlagsä¸­çš„ç¬¬17å’Œ18ä½ç”¨æ¥è¡¨ç¤ºè¿™ä¸ªé¡ºåº</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> FLAG_MASK_FOCUSABILITY = <span class="number">0x60000</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">protected</span> <span class="keyword">int</span> mGroupFlags;</span><br></pre></td></tr></table></figure>
<p>ViewGroupçš„FLAG_MASK_FOCUSABILITYæ˜¯ç”¨æ¥æ§åˆ¶ç„¦ç‚¹åœ¨Viewæ ‘ä¸­çš„ä¼ é€’é¡ºåºçš„ï¼Œé¡ºåºæœ‰ä¸‰ç§ï¼š</p>
<ul>
<li><strong>FOCUS_BEFORE_DESCENDANTS</strong>ï¼š åœ¨æ‰€æœ‰å­Viewä¹‹å‰ï¼Œè‡ªå·±æ²¡è·å–å†ç»™å­View</li>
<li> <strong>FOCUS_AFTER_DESCENDANTS</strong>ï¼š åœ¨æ‰€æœ‰å­Viewä¹‹åï¼Œæ‰€æœ‰å­Viewéƒ½æ²¡èƒ½è·å¾—ç„¦ç‚¹æ‰é—®ä¸‹è‡ªå·±èƒ½ä¸èƒ½</li>
<li> <strong>FOCUS_BLOCK_DESCENDANTS</strong>ï¼š ä¸é€šçŸ¥å­View ï¼Œå³ä½¿è‡ªå·±è·å–ä¸åˆ°</li>
</ul>
<p>å’ŒViewçš„ç„¦ç‚¹æ¨¡å¼ä¸€æ ·ï¼Œè·å¾—ç„¦ç‚¹çš„é¡ºåºä¹Ÿæ˜¯åœ¨æ„é€ æ–¹æ³•ä¸­è®¾ç½®çš„:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">ViewGroupä¸­</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span>[] DESCENDANT_FOCUSABILITY_FLAGS =</span><br><span class="line">            &#123;FOCUS_BEFORE_DESCENDANTS, FOCUS_AFTER_DESCENDANTS,</span><br><span class="line">                    FOCUS_BLOCK_DESCENDANTS&#125;;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">ViewGroup</span><span class="params">(Context context, AttributeSet attrs, <span class="keyword">int</span> defStyleAttr, <span class="keyword">int</span> defStyleRes)</span> </span>&#123;</span><br><span class="line">        ......</span><br><span class="line">        <span class="keyword">case</span> R.styleable.ViewGroup_descendantFocusability:</span><br><span class="line">            <span class="comment">//é»˜è®¤æ˜¯FOCUS_BEFORE_DESCENDANTS</span></span><br><span class="line">            setDescendantFocusability(DESCENDANT_FOCUSABILITY_FLAGS[a.getInt(attr, <span class="number">0</span>)]);</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setDescendantFocusability</span><span class="params">(<span class="keyword">int</span> focusability)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">switch</span> (focusability) &#123;</span><br><span class="line">                <span class="keyword">case</span> FOCUS_BEFORE_DESCENDANTS:</span><br><span class="line">                <span class="keyword">case</span> FOCUS_AFTER_DESCENDANTS:</span><br><span class="line">                <span class="keyword">case</span> FOCUS_BLOCK_DESCENDANTS:</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">default</span>:</span><br><span class="line">                    <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">&quot;must be one of FOCUS_BEFORE_DESCENDANTS, &quot;</span></span><br><span class="line">                            + <span class="string">&quot;FOCUS_AFTER_DESCENDANTS, FOCUS_BLOCK_DESCENDANTS&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">//è®¾ç½®é¡ºåº</span></span><br><span class="line">            mGroupFlags &amp;= ~FLAG_MASK_FOCUSABILITY;</span><br><span class="line">            mGroupFlags |= (focusability &amp; FLAG_MASK_FOCUSABILITY);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>ä»ä»£ç ä¸­å¯ä»¥å‘ç°ï¼Œå¦‚æœä¸å†™è¿™ä¸ªå±æ€§ï¼ŒViewGroupè®¾ç½®è‡ªå·±åœ¨æ‰€æœ‰å­Viewä¹‹å‰å¤„ç†ç„¦ç‚¹.</p>
<h3 id="Viewçš„requestFocusæ–¹æ³•"><a href="#Viewçš„requestFocusæ–¹æ³•" class="headerlink" title="Viewçš„requestFocusæ–¹æ³•"></a>Viewçš„requestFocusæ–¹æ³•</h3><p>è¦è®©ä¸€ä¸ªViewè·å¾—ç„¦ç‚¹ï¼Œéœ€è¦è°ƒç”¨å®ƒçš„requestFocusæ–¹æ³•ï¼Œè°ƒç”¨æ—¶åºå›¾å¦‚ä¸‹ï¼ˆå…·ä½“çš„æ–¹æ³•å¯ä»¥ç›´æ¥æœç´¢æºç ï¼‰ï¼š<br><img src="https://raw.githubusercontent.com/msisuzney/MyBlog/master/images/6_requestFocus.png" alt="requestFocus.png"></p>
<p>Viewå…ˆè°ƒç”¨è‡ªå·±çš„canTakeFocusæ–¹æ³•ç¡®è®¤è‡ªå·±æ˜¯ä¸æ˜¯èƒ½å¤Ÿè·å¾—ç„¦ç‚¹ï¼Œè¿™ä¸ªæ–¹æ³•å¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">boolean</span> <span class="title">canTakeFocus</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> ((mViewFlags &amp; VISIBILITY_MASK) == VISIBLE)</span><br><span class="line">            &amp;&amp; ((mViewFlags &amp; FOCUSABLE) == FOCUSABLE)</span><br><span class="line">            &amp;&amp; ((mViewFlags &amp; ENABLED_MASK) == ENABLED)</span><br><span class="line">            &amp;&amp; (sCanFocusZeroSized || !isLayoutValid() || hasSize());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>åˆ¤æ–­çš„ä¾æ®æ˜¯ : <strong>1.viewå¯è§   2.å¯ä»¥è·å¾—ç„¦ç‚¹   3.æ˜¯enableçš„   4.æœ‰å¤§å°</strong><br>ç„¶åé€’å½’è°ƒç”¨æ‰€æœ‰çˆ¶Viewçš„hasAncestorThatBlocksDescendantFocusæ–¹æ³•ï¼Œç¡®è®¤çˆ¶Viewæ˜¯ä¸æ˜¯è®¾ç½®äº†æ‹¦æˆªç„¦ç‚¹ï¼Œå¦‚æœçˆ¶Viewæ‹¦æˆªäº†ç„¦ç‚¹ï¼Œè‡ªå·±å°±ä¸èƒ½è·å¾—ç„¦ç‚¹ã€‚<br>å¦‚æœä¸Šé¢ä¸¤é¡¹éƒ½é€šè¿‡äº†ï¼Œé‚£å°±å¯ä»¥åæ­£è¨€é¡ºçš„è·å¾—ç„¦ç‚¹äº†ï¼ŒhandleFocusGainInternalæ–¹æ³•å¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">  <span class="function"><span class="keyword">void</span> <span class="title">handleFocusGainInternal</span><span class="params">(<span class="meta">@FocusRealDirection</span> <span class="keyword">int</span> direction, Rect previouslyFocusedRect)</span> </span>&#123;</span><br><span class="line">      <span class="keyword">if</span> (DBG) &#123;</span><br><span class="line">          System.out.println(<span class="keyword">this</span> + <span class="string">&quot; requestFocus()&quot;</span>);</span><br><span class="line">      &#125;</span><br><span class="line"><span class="comment">//ä¿®æ”¹çŠ¶æ€ï¼Œflagæ·»åŠ PFLAG_FOCUSEDï¼Œæ ‡è®°è‡ªå·±æœ‰ç„¦ç‚¹</span></span><br><span class="line">      <span class="keyword">if</span> ((mPrivateFlags &amp; PFLAG_FOCUSED) == <span class="number">0</span>) &#123;</span><br><span class="line">          mPrivateFlags |= PFLAG_FOCUSED;</span><br><span class="line"></span><br><span class="line">          View oldFocus = (mAttachInfo != <span class="keyword">null</span>) ? getRootView().findFocus() : <span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line">          <span class="keyword">if</span> (mParent != <span class="keyword">null</span>) &#123;</span><br><span class="line">              <span class="comment">//é€šçŸ¥çˆ¶Viewï¼Œæˆ‘ç°åœ¨æ˜¯é‚£ä¸ªæœ‰ç„¦ç‚¹çš„View</span></span><br><span class="line">              mParent.requestChildFocus(<span class="keyword">this</span>, <span class="keyword">this</span>);</span><br><span class="line">              updateFocusedInCluster(oldFocus, direction);</span><br><span class="line">          &#125;</span><br><span class="line">	<span class="comment">//è°ƒç”¨è®¾ç½®çš„Viewæ ‘å…¨å±€ç„¦ç‚¹å˜åŒ–ç›‘å¬</span></span><br><span class="line">          <span class="keyword">if</span> (mAttachInfo != <span class="keyword">null</span>) &#123;</span><br><span class="line">              mAttachInfo.mTreeObserver.dispatchOnGlobalFocusChange(oldFocus, <span class="keyword">this</span>);</span><br><span class="line">          &#125;</span><br><span class="line">	<span class="comment">//è°ƒç”¨è‡ªå·±çš„onFocusChangeListeneræ–¹æ³•</span></span><br><span class="line">          onFocusChanged(<span class="keyword">true</span>, direction, previouslyFocusedRect);</span><br><span class="line">          refreshDrawableState();</span><br><span class="line">      &#125;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<p>æ–¹æ³•ä¸­å°†mPrivateFlagsä¸­çš„è¡¨ç¤ºæ˜¯å¦æœ‰ç„¦ç‚¹çš„bitç½®ä¸º1ï¼Œè¡¨ç¤ºè‡ªå·±æœ‰ç„¦ç‚¹ï¼Œè¿™åœ¨ä¸Šä¸€ç« ä¸­åˆ†æè¿‡ï¼Œä¹‹åè°ƒç”¨çˆ¶Viewçš„requestChildFocusçš„æ–¹æ³•ï¼Œå¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"> <span class="meta">@Override</span></span><br><span class="line"> <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">requestChildFocus</span><span class="params">(View child, View focused)</span> </span>&#123;</span><br><span class="line">		......</span><br><span class="line">     <span class="keyword">if</span> (getDescendantFocusability() == FOCUS_BLOCK_DESCENDANTS) &#123;</span><br><span class="line">         <span class="keyword">return</span>;</span><br><span class="line">     &#125;</span><br><span class="line">     <span class="comment">// Unfocus us, if necessary</span></span><br><span class="line">     <span class="keyword">super</span>.unFocus(focused);</span><br><span class="line">     <span class="comment">// We had a previous notion of who had focus. Clear it.</span></span><br><span class="line">     <span class="keyword">if</span> (mFocused != child) &#123;</span><br><span class="line">         <span class="keyword">if</span> (mFocused != <span class="keyword">null</span>) &#123;</span><br><span class="line">             mFocused.unFocus(focused);</span><br><span class="line">         &#125;</span><br><span class="line"><span class="comment">//ä¿®æ”¹mFocusedå˜é‡ï¼ŒæŒ‡å‘è¿™ä¸ªæ–°çš„è·å¾—ç„¦ç‚¹çš„å­View</span></span><br><span class="line">         mFocused = child;</span><br><span class="line">     &#125;</span><br><span class="line">     <span class="keyword">if</span> (mParent != <span class="keyword">null</span>) &#123;</span><br><span class="line">         <span class="comment">//å‘Šè¯‰çˆ¶Viewï¼Œæˆ‘æ˜¯é‚£ä¸ªåŒ…å«ç„¦ç‚¹Viewçš„ä¹–å„¿å­</span></span><br><span class="line">         mParent.requestChildFocus(<span class="keyword">this</span>, focused);     </span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>
<p>çˆ¶Viewçš„requestChildFocusæ–¹æ³•ä¸­å°†mFocusedæˆå‘˜å˜é‡æŒ‡å‘è¿™ä¸ªæœ‰ç„¦ç‚¹çš„Viewï¼Œç„¶åé€šçŸ¥è‡ªå·±çš„çˆ¶View<strong>æˆ‘æ˜¯é‚£ä¸ªåŒ…å«ç„¦ç‚¹Viewçš„å­View</strong>ï¼Œå¦‚æ­¤éå†æ‰€æœ‰çš„çˆ¶Viewï¼Œç›´åˆ°ViewRootImplï¼Œè¿™æ ·å°±ä¿®æ”¹æ‰€æœ‰çš„çˆ¶Viewä¸­çš„mFocusedå˜é‡äº†ï¼Œä¹‹åæœ‰æŒ‰é”®äº‹ä»¶æ—¶å°±æŒ‰è¿™ä¸ªè·¯å¾„ä¼ é€’KeyEventï¼Œè¿™ä¹Ÿåœ¨ä¸Šä¸€ç¯‡ä¸­ä¹Ÿæœ‰åˆ†æã€‚</p>
<h3 id="ViewGroupçš„requestFocusæ–¹æ³•"><a href="#ViewGroupçš„requestFocusæ–¹æ³•" class="headerlink" title="ViewGroupçš„requestFocusæ–¹æ³•"></a>ViewGroupçš„requestFocusæ–¹æ³•</h3><p>ViewGroupå¤å†™äº†Viewçš„requestFocus(int direction, Rect previouslyFocusedRect)æ–¹æ³•ï¼Œå¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"> <span class="meta">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">requestFocus</span><span class="params">(<span class="keyword">int</span> direction, Rect previouslyFocusedRect)</span> </span>&#123;</span><br><span class="line"><span class="comment">//è·å–ViewGroupç›¸å¯¹äºå­Viewçš„è·å¾—ç„¦ç‚¹çš„é¡ºåº</span></span><br><span class="line">      <span class="keyword">int</span> descendantFocusability = getDescendantFocusability();</span><br><span class="line"></span><br><span class="line">      <span class="keyword">boolean</span> result;</span><br><span class="line">      <span class="keyword">switch</span> (descendantFocusability) &#123;</span><br><span class="line">           <span class="comment">//æ‹¦æˆªç„¦ç‚¹ï¼Œç›´æ¥è°ƒç”¨è‡ªå·±çš„è·å–ç„¦ç‚¹çš„é€»è¾‘</span></span><br><span class="line">          <span class="keyword">case</span> FOCUS_BLOCK_DESCENDANTS:</span><br><span class="line">              result = <span class="keyword">super</span>.requestFocus(direction, previouslyFocusedRect);</span><br><span class="line">              <span class="keyword">break</span>;</span><br><span class="line">          <span class="comment">//åœ¨å­Viewä¹‹å‰ï¼Œè°ƒç”¨è‡ªå·±çš„è·å–ç„¦ç‚¹çš„é€»è¾‘ï¼Œå¦‚æœä¸èƒ½è·å¾—ï¼Œéå†å­Viewï¼Œè®©å…ˆå­Viewå¤„ç†</span></span><br><span class="line">          <span class="keyword">case</span> FOCUS_BEFORE_DESCENDANTS: &#123;</span><br><span class="line">              <span class="keyword">final</span> <span class="keyword">boolean</span> took = <span class="keyword">super</span>.requestFocus(direction, previouslyFocusedRect);</span><br><span class="line">              result = took ? took : onRequestFocusInDescendants(direction,</span><br><span class="line">                      previouslyFocusedRect);</span><br><span class="line">              <span class="keyword">break</span>;</span><br><span class="line">          &#125;</span><br><span class="line">          <span class="comment">//åœ¨å­viewä¹‹åï¼Œå…ˆéå†å­Viewï¼Œè®©å­Viewå¤„ç†ï¼Œå¦‚æœå®ƒä»¬éƒ½ä¸å¤„ç†ï¼Œåˆ™å†è‡ªå·±å¤„ç†</span></span><br><span class="line">          <span class="keyword">case</span> FOCUS_AFTER_DESCENDANTS: &#123;</span><br><span class="line">              <span class="keyword">final</span> <span class="keyword">boolean</span> took = onRequestFocusInDescendants(direction, previouslyFocusedRect);</span><br><span class="line">              result = took ? took : <span class="keyword">super</span>.requestFocus(direction, previouslyFocusedRect);</span><br><span class="line">              <span class="keyword">break</span>;</span><br><span class="line">          &#125;</span><br><span class="line">          <span class="keyword">default</span>:</span><br><span class="line">              <span class="keyword">throw</span> <span class="keyword">new</span> IllegalStateException(<span class="string">&quot;descendant focusability must be &quot;</span></span><br><span class="line">                      + <span class="string">&quot;one of FOCUS_BEFORE_DESCENDANTS, FOCUS_AFTER_DESCENDANTS, FOCUS_BLOCK_DESCENDANTS &quot;</span></span><br><span class="line">                      + <span class="string">&quot;but is &quot;</span> + descendantFocusability);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">if</span> (result &amp;&amp; !isLayoutValid() &amp;&amp; ((mPrivateFlags &amp; PFLAG_WANTS_FOCUS) == <span class="number">0</span>)) &#123;</span><br><span class="line">          mPrivateFlags |= PFLAG_WANTS_FOCUS;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> result;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<p>åœ¨è¿™ä¸ªæ–¹æ³•ä¸­ViewGroupæ ¹æ®è‡ªå·±ç›¸å¯¹å­Viewè·å¾—ç„¦ç‚¹çš„é¡ºåºæ¥ç¡®è®¤è°ƒç”¨æ–¹æ³•çš„é¡ºåºã€‚ä»ä»£ç ä¸­å¯ä»¥çœ‹å‡ºå¦‚æœä¸€ä¸ªViewGroupè¦è·å¾—ç„¦ç‚¹å®ƒçš„é€»è¾‘å’ŒViewæ˜¯ä¸€æ ·çš„ï¼Œè€Œä¸”ç”±äºViewGroupé»˜è®¤è®¾ç½®äº†FOCUS_BEFORE_DESCENDANTSï¼Œå¦‚æœå®ƒå†è®¾ç½®focusableä¸ºtrueï¼Œå®ƒçš„æƒ³è·å¾—ç„¦ç‚¹çš„å„¿å­ä»¬å°±ä¸è¦æŒ‡æœ›çˆ¸çˆ¸ä¸»åŠ¨ç»™ç„¦ç‚¹äº†ğŸ˜‚ï¼Œåªèƒ½é€šè¿‡è‡ªå·±çš„requestFocuså»è·å¾—ã€‚</p>
<h3 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><p>ç®€çŸ­æ€»ç»“ä¸€ä¸‹æœ¬ç¯‡çš„å†…å®¹ï¼š  </p>
<ol>
<li>Viewçš„ç„¦ç‚¹æ¨¡å¼å¯ä»¥ä½¿ç”¨focusableå±æ€§å®šä¹‰ï¼Œä¹Ÿä¸clickableå±æ€§æœ‰å…³è”</li>
<li>ViewGroupåœ¨Viewçš„åŸºç¡€ä¸Šå®šä¹‰äº†è‡ªå·±ç›¸å¯¹äºå­Viewçš„å¤„ç†ç„¦ç‚¹çš„é¡ºåº  </li>
<li>Viewé€šè¿‡requestFocusæ–¹æ³•è·å¾—ç„¦ç‚¹  </li>
<li>ViewGroupå¤å†™äº†requestFocusæ–¹æ³•ï¼ŒåŠ å…¥äº†é¡ºåºåˆ¤æ–­   </li>
</ol>
<p>åˆ°è¿™é‡ŒæŒ‰é”®äº‹ä»¶çš„åˆ†å‘å’Œè·å¾—ç„¦ç‚¹çš„è¿‡ç¨‹åˆ†æå®Œæ¯•ï¼Œä½†äº‹æƒ…è¿˜æ²¡å®Œï¼Œå½“æŒ‰ä¸‹æŒ‰é”®æ—¶ä¼šå‘ç°ç„¦ç‚¹ä¼šåœ¨Viewä¹‹é—´ç§»åŠ¨ï¼Œé‚£æŒ‰é”®äº‹ä»¶æ˜¯æ€ä¹ˆè½¬æ¢ä¸ºç„¦ç‚¹Viewçš„å˜åŒ–çš„å‘¢ï¼Ÿè¯·çœ‹ä¸‹ç¯‡åˆ†æï¼š Android TVå¼€å‘æŒ‰é”®ä¸ç„¦ç‚¹æ·±å…¥è§£æï¼ˆä¸‰ï¼‰â€“æŒ‰é”®äº‹ä»¶è½¬æ¢æˆç„¦ç‚¹ç§»åŠ¨çš„è¿‡ç¨‹</p>

    </div>

    
    
    
        

<div>
<ul class="post-copyright">
  <li class="post-copyright-author">
    <strong>æœ¬æ–‡ä½œè€…ï¼š </strong>
  </li>
  <li class="post-copyright-link">
    <strong>æœ¬æ–‡é“¾æ¥ï¼š</strong>
    <a href="https://msisuzney.github.io/2020/08/27/Android-TV%E5%BC%80%E5%8F%91%E6%8C%89%E9%94%AE%E4%B8%8E%E7%84%A6%E7%82%B9%E6%B7%B1%E5%85%A5%E8%A7%A3%E6%9E%90%EF%BC%88%E4%BA%8C%EF%BC%89-View%E7%9A%84%E7%84%A6%E7%82%B9/" title="Android TVå¼€å‘æŒ‰é”®ä¸ç„¦ç‚¹æ·±å…¥åˆ†æï¼ˆäºŒï¼‰--Viewçš„ç„¦ç‚¹">https://msisuzney.github.io/2020/08/27/Android-TVå¼€å‘æŒ‰é”®ä¸ç„¦ç‚¹æ·±å…¥è§£æï¼ˆäºŒï¼‰-Viewçš„ç„¦ç‚¹/</a>
  </li>
  <li class="post-copyright-license">
    <strong>ç‰ˆæƒå£°æ˜ï¼š </strong>æœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨ <a href="https://creativecommons.org/licenses/by-nc-nd/4.0/deed.zh" rel="noopener" target="_blank"><i class="fab fa-fw fa-creative-commons"></i>BY-NC-ND</a> è®¸å¯åè®®ã€‚è½¬è½½è¯·æ³¨æ˜å‡ºå¤„ï¼
  </li>
</ul>
</div>


      <footer class="post-footer">

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2020/08/24/Android-TV%E5%BC%80%E5%8F%91%E6%8C%89%E9%94%AE%E4%B8%8E%E7%84%A6%E7%82%B9%E6%B7%B1%E5%85%A5%E5%88%86%E6%9E%90%EF%BC%88%E4%B8%80%EF%BC%89-KeyEvent%E7%9A%84%E5%88%86%E5%8F%91/" rel="prev" title="Android-TVå¼€å‘æŒ‰é”®ä¸ç„¦ç‚¹æ·±å…¥åˆ†æï¼ˆä¸€ï¼‰--KeyEventçš„åˆ†å‘">
      <i class="fa fa-chevron-left"></i> Android-TVå¼€å‘æŒ‰é”®ä¸ç„¦ç‚¹æ·±å…¥åˆ†æï¼ˆä¸€ï¼‰--KeyEventçš„åˆ†å‘
    </a></div>
      <div class="post-nav-item">
    <a href="/2020/09/14/Android-TV%E5%BC%80%E5%8F%91%E6%8C%89%E9%94%AE%E4%B8%8E%E7%84%A6%E7%82%B9%E6%B7%B1%E5%85%A5%E5%88%86%E6%9E%90%EF%BC%88%E4%B8%89%EF%BC%89-%E6%8C%89%E9%94%AE%E4%BA%8B%E4%BB%B6%E8%BD%AC%E6%8D%A2%E6%88%90%E7%84%A6%E7%82%B9%E7%A7%BB%E5%8A%A8%E7%9A%84%E8%BF%87%E7%A8%8B/" rel="next" title="Android TVå¼€å‘æŒ‰é”®ä¸ç„¦ç‚¹æ·±å…¥åˆ†æï¼ˆä¸‰ï¼‰--æŒ‰é”®äº‹ä»¶è½¬æ¢æˆç„¦ç‚¹ç§»åŠ¨çš„è¿‡ç¨‹">
      Android TVå¼€å‘æŒ‰é”®ä¸ç„¦ç‚¹æ·±å…¥åˆ†æï¼ˆä¸‰ï¼‰--æŒ‰é”®äº‹ä»¶è½¬æ¢æˆç„¦ç‚¹ç§»åŠ¨çš„è¿‡ç¨‹ <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          æ–‡ç« ç›®å½•
        </li>
        <li class="sidebar-nav-overview">
          ç«™ç‚¹æ¦‚è§ˆ
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-3"><a class="nav-link" href="#View%E7%9A%84%E7%84%A6%E7%82%B9%E6%A8%A1%E5%BC%8F"><span class="nav-number">1.</span> <span class="nav-text">Viewçš„ç„¦ç‚¹æ¨¡å¼</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#ViewGroup%E7%9A%84%E7%84%A6%E7%82%B9%E6%A8%A1%E5%BC%8F"><span class="nav-number">2.</span> <span class="nav-text">ViewGroupçš„ç„¦ç‚¹æ¨¡å¼</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#View%E7%9A%84requestFocus%E6%96%B9%E6%B3%95"><span class="nav-number">3.</span> <span class="nav-text">Viewçš„requestFocusæ–¹æ³•</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#ViewGroup%E7%9A%84requestFocus%E6%96%B9%E6%B3%95"><span class="nav-number">4.</span> <span class="nav-text">ViewGroupçš„requestFocusæ–¹æ³•</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%80%BB%E7%BB%93"><span class="nav-number">5.</span> <span class="nav-text">æ€»ç»“</span></a></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt=""
      src="/images/avatar.jpg">
  <p class="site-author-name" itemprop="name"></p>
  <div class="site-description" itemprop="description">æ—¶å…‰çš„çƒ‚ç¬”å¤´</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">24</span>
          <span class="site-state-item-name">æ—¥å¿—</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">8</span>
        <span class="site-state-item-name">åˆ†ç±»</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/msisuzney" title="GitHub â†’ https:&#x2F;&#x2F;github.com&#x2F;msisuzney" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:chenxin7930@qq.com" title="E-Mail â†’ mailto:chenxin7930@qq.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2023</span>
  <span class="with-love">
    <i class="fa fa-feather"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">chenxin</span>
</div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/muse.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  

</body>
</html>
